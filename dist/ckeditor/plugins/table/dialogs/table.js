/*
 Copyright (c) 2003-2014, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){function q(a){for(var d=0,j=0,l=0,k,r=a.$.rows.length;l<r;l++){k=a.$.rows[l];for(var b=d=0,c,e=k.cells.length;b<e;b++)c=k.cells[b],d+=c.colSpan;d>j&&(j=d)}return j}function n(a){return function(){var d=this.getValue(),d=!!(CKEDITOR.dialog.validate.integer()(d)&&0<d);d||(alert(a),this.select());return d}}function o(a,d){var j=function(k){return new CKEDITOR.dom.element(k,a.document)};a.editable();var l=a.plugins.dialogadvtab;return{title:a.lang.table.title,minWidth:310,minHeight:180,onLoad:function(){var a=
this,d=a.getContentElement("advanced","advStyles");if(d)d.on("change",function(){var b=this.getStyle("width",""),c=a.getContentElement("info","txtWidth");c&&c.setValue(b,!0);b=this.getStyle("height","");(c=a.getContentElement("info","txtHeight"))&&c.setValue(b,!0)})},onShow:function(){var k=a.getSelection(),j=k.getRanges(),b,c=this.getContentElement("info","txtRows"),e=this.getContentElement("info","txtCols"),i=this.getContentElement("info","txtWidth"),f=this.getContentElement("info","txtHeight");
"tableProperties"==d&&((k=k.getSelectedElement())&&k.is("table")?b=k:0<j.length&&(CKEDITOR.env.webkit&&j[0].shrink(CKEDITOR.NODE_ELEMENT),b=a.elementPath(j[0].getCommonAncestor(!0)).contains("table",1)),this._.selectedElement=b);b?(this.setupContent(b),c&&c.disable(),e&&e.disable()):(c&&c.enable(),e&&e.enable());i&&i.onChange();f&&f.onChange()},onOk:function(){var d=a.getSelection(),l=this._.selectedElement&&d.createBookmarks(),b=this._.selectedElement||j("table"),c={};a.config.default_table_class&&
b.addClass(a.config.default_table_class);this.commitContent(c,b);if(c.info){c=c.info;if(!this._.selectedElement)for(var e=b.append(j("tbody")),i=parseInt(c.txtRows,10)||0,f=parseInt(c.txtCols,10)||0,g=0;g<i;g++)for(var h=e.append(j("tr")),m=0;m<f;m++)h.append(j("td")).appendBogus();i=c.selHeaders;if(!b.$.tHead&&("row"==i||"both"==i)){h=new CKEDITOR.dom.element(b.$.createTHead());e=b.getElementsByTag("tbody").getItem(0);e=e.getElementsByTag("tr").getItem(0);for(g=0;g<e.getChildCount();g++)f=e.getChild(g),
f.type==CKEDITOR.NODE_ELEMENT&&!f.data("cke-bookmark")&&(f.renameNode("th"),f.setAttribute("scope","col"));h.append(e.remove())}if(null!==b.$.tHead&&!("row"==i||"both"==i)){h=new CKEDITOR.dom.element(b.$.tHead);e=b.getElementsByTag("tbody").getItem(0);for(m=e.getFirst();0<h.getChildCount();){e=h.getFirst();for(g=0;g<e.getChildCount();g++)f=e.getChild(g),f.type==CKEDITOR.NODE_ELEMENT&&(f.renameNode("td"),f.removeAttribute("scope"));e.insertBefore(m)}h.remove()}if(!this.hasColumnHeaders&&("col"==i||
"both"==i))for(h=0;h<b.$.rows.length;h++)f=new CKEDITOR.dom.element(b.$.rows[h].cells[0]),f.renameNode("th"),f.setAttribute("scope","row");if(this.hasColumnHeaders&&!("col"==i||"both"==i))for(g=0;g<b.$.rows.length;g++)h=new CKEDITOR.dom.element(b.$.rows[g]),"tbody"==h.getParent().getName()&&(f=new CKEDITOR.dom.element(h.$.cells[0]),f.renameNode("td"),f.removeAttribute("scope"));c.txtHeight?b.setStyle("height",c.txtHeight):b.removeStyle("height");c.txtWidth?b.setStyle("width",c.txtWidth):b.removeStyle("width");
b.getAttribute("style")||b.removeAttribute("style")}if(this._.selectedElement)try{d.selectBookmarks(l)}catch(n){}else a.insertElement(b),setTimeout(function(){var c=new CKEDITOR.dom.element(b.$.rows[0].cells[0]),d=a.createRange();d.moveToPosition(c,CKEDITOR.POSITION_AFTER_START);d.select()},0)},contents:[{id:"info",label:a.lang.table.title,elements:[{type:"text",id:"txtCols","default":5,label:a.lang.table.columns,required:!0,labelLayout:"horizontal",validate:n(a.lang.table.invalidCols),setup:function(a){this.setValue(q(a))},
commit:p},{type:"text",id:"txtRows","default":2,label:a.lang.table.rows,required:!0,labelLayout:"horizontal",validate:n(a.lang.table.invalidRows),setup:function(a){this.setValue(a.$.rows.length)},commit:p}]},l&&l.createAdvancedTab(a,null,"table")]}}var p=function(a){var d=this.id;a.info||(a.info={});a.info[d]=this.getValue()};CKEDITOR.dialog.add("table",function(a){return o(a,"table")});CKEDITOR.dialog.add("tableProperties",function(a){return o(a,"tableProperties")})})();