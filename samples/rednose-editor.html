<!DOCTYPE html>

<html>
<head>
    <script src="../stage/ckeditor.js"></script>
    <!--<script src="../dist/ckeditor/ckeditor.js"></script>-->
</head>
<body>
<textarea id="editor">
</textarea>
<script>
    CKEDITOR.stylesSet.add('doctanium', [
        {name: 'Tabel', element: 'table', attributes: { 'class': 'Tabel'}},

        {name: 'Standaard', element: 'p', attributes: {'class': 'Standaard'}},
        {name: 'NotaTitel', element: 'p', attributes: {'class': 'NotaTitel'}},
        {name: 'NotaKop1', element: 'p', attributes: {'class': 'NotaKop1'}},
        {name: 'NotaKop2', element: 'p', attributes: {'class': 'NotaKop2'}},
        {name: 'NotaKop3', element: 'p', attributes: {'class': 'NotaKop3'}}
    ]);

    var editor = CKEDITOR.replace('editor', {
        default_table_class: 'Tabel',
        contentsCss: 'doctanium.css',
        stylesSet: 'doctanium',
        height: 550
    });

    //    CKEDITOR.on( 'instanceReady', function( evt ) {
    //        var editor = evt.editor;
    //
    //        var dataProcessor = editor.dataProcessor,
    //                dataFilter = dataProcessor && dataProcessor.dataFilter,
    //                htmlFilter = dataProcessor && dataProcessor.htmlFilter;
    //
    //        // This rewrites incoming (GET, viewing) data
    //        if (dataFilter) {
    //            dataFilter.addRules({
    //                elements: {
    //                    'p': function (element) {
    //                        console.log('p');
    //                        element.attributes['class'] = 'Standaard';
    //                        return element;
    //                    }
    //                }
    //            });
    //        }
    //    });

    CKEDITOR.on( 'instanceLoaded', function( evt ) {
        var editor = evt.editor;

        function fixDom( evt ) {
            var editor = evt.editor;
            var paragraphs = editor.document.find('p');

            for (var i = 0; i < paragraphs.count(); i++) {
                var p = paragraphs.getItem(i);

                if (!p.getAttribute('class')) {
                    p.addClass('Standaard');
                }
            }
        }

        editor.on( 'selectionChange', function( evt ) {
            console.log('as');
            if ( editor.readOnly )
                return;

            // Auto fixing on some document structure weakness to enhance usabilities. (#3190 and #3189)
            var sel = editor.getSelection();
            // Do it only when selection is not locked. (#8222)
            if ( sel && !sel.isLocked ) {
                var isDirty = editor.checkDirty();

                // Lock undoM before touching DOM to prevent
                // recording these changes as separate snapshot.
                editor.fire( 'lockSnapshot' );
                fixDom( evt );
                editor.fire( 'unlockSnapshot' );

                !isDirty && editor.resetDirty();
            }
        }, null, null, null, 1 );


    } );
</script>
</body>
<html>
